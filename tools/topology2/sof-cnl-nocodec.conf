
#
# Simple Machine - High level topology - Maps to machine driver.
#
#
# PCM 0 <-> bufferN.0 <-> volumeN.0 <-> bufferN.1 -> SSP0
#

<include/common/tokens.conf>
<include/components/volume.conf>
<include/components/host.conf>
<include/components/buffer.conf>
<include/components/pipeline.conf>
<include/common/route.conf>
<include/controls/mixer.conf>
<include/pipelines/pipeline-volume-playback.conf>
<include/pipelines/pipeline-volume-capture.conf>
<include/pipelines/pipeline-passthrough-capture.conf>
<include/components/dai.conf>
<include/common/data.conf>
<include/common/pcm.conf>
<include/common/pcm_caps.conf>
<include/common/fe_dai.conf>
<include/dais/ssp.conf>
<include/dais/hw_config.conf>
<include/dais/dmic.conf>
<include/dais/pdm_config.conf>
<include/common/manifest.conf>
<include/common/pcm.conf>
<include/common/fe_dai.conf>
<include/common/pcm_caps.conf>

#
# Pipeline definitions
#

# Pipeline ID:1
Object.Pipeline.volume-playback."1" {
	format	"s24le"

	# set the mixer name for PGA.0
	Object.Widget.pga.0 {
		Object.Control.mixer.0 {
			name "1 Master Playback Volume"
		}
	}

	# set pipeline stream_name
	Object.Widget.pipeline.0.stream_name	"dai.SSP.0.playback"

	# set host stream_name to be same as the playback PCM caps
	Object.Widget.host.playback.stream_name	"Port0 Playback"
}

# Pipeline ID:2
Object.Pipeline.volume-capture."2" {
	#pipeline_id	2
	format		"s24le"

	# set the mixer name for PGA.0
	Object.Widget.pga.0 {
		Object.Control.mixer.0 {
			name "2 Master Capture Volume"
		}
		Object.Control.mixer.1 {
			name "2 Master Capture Switch"
		}
	}

	# set pipeline stream_name
	Object.Widget.pipeline.0.stream_name	"dai.SSP.0.capture"

	# set host stream_name to be same as the capture PCM caps
	Object.Widget.host.capture.stream_name	"Port0 Capture"
}

Object.Pipeline.volume-playback."3" {
	format	"s24le"

	# set the mixer name for PGA.0
	Object.Widget.pga.0 {
		Object.Control.mixer.0 {
			name "3 Master Playback Volume"
		}
	}

	# set pipeline stream_name
	Object.Widget.pipeline.0.stream_name	"dai.SSP.1.playback"

	# set host stream_name to be same as the playback PCM caps
	Object.Widget.host.playback.stream_name	"Port1 Playback"
}

Object.Pipeline.volume-capture."4" {
	#pipeline_id	2
	format		"s24le"

	# set the mixer name for PGA.0
	# set the mixer name for PGA.0
	Object.Widget.pga.0 {
		Object.Control.mixer.0 {
			name "4 Master Capture Volume"
		}
		Object.Control.mixer.1 {
			name "4 Master Capture Switch"
		}
	}

	# set pipeline stream_name
	Object.Widget.pipeline.0.stream_name	"dai.SSP.1.capture"

	# set host stream_name to be same as the capture PCM caps
	Object.Widget.host.capture.stream_name	"Port1 Capture"
}

Object.Pipeline.volume-playback."5" {
	format	"s24le"

	# set the mixer name for PGA.0
	Object.Widget.pga.0 {
		Object.Control.mixer.0 {
			name "5 Master Playback Volume"
		}
	}

	# set pipeline stream_name
	Object.Widget.pipeline.0.stream_name	"dai.SSP.2.playback"

	# set host stream_name to be same as the playback PCM caps
	Object.Widget.host.playback.stream_name	"Port2 Playback"
}

Object.Pipeline.volume-capture."6" {
	format		"s24le"

	# set the mixer name for PGA.0
	Object.Widget.pga.0 {
		Object.Control.mixer.0 {
			name "6 Master Capture Volume"
		}
		Object.Control.mixer.1 {
			name "6 Master Capture Switch"
		}
	}

	# set pipeline stream_name
	Object.Widget.pipeline.0.stream_name	"dai.SSP.2.capture"

	# set host stream_name to be same as the capture PCM caps
	Object.Widget.host.capture.stream_name	"Port2 Capture"
}

Object.Pipeline.passthrough-capture."7" {
	format	"s32le"
	channels	4
	channels_min	4
	channels_max	4

	Object.Widget.pipeline.0.stream_name	"dai.DMIC.0.capture"

	Object.Widget.host.capture.stream_name	"DMIC01 Capture"
}

#
# PCM Definitions
#
# PCM ID: 0
Object.PCM.pcm."0" {
	name	"Port0"
	direction	"duplex"
	Object.Base.fe_dai."Port 0" {}
	Object.PCM.pcm_caps."playback" {
		name "Port0 Playback"
	}
	Object.PCM.pcm_caps."capture" {
		name "Port0 Capture"
	}
}

Object.PCM.pcm."1" {
	name	"Port1"
	direction	"duplex"
	Object.Base.fe_dai."Port 1" {}
	Object.PCM.pcm_caps."playback" {
		name "Port1 Playback"
	}
	Object.PCM.pcm_caps."capture" {
		name "Port1 Capture"
	}
}

Object.PCM.pcm."2" {
	name	"Port2"
	direction	"duplex"
	Object.Base.fe_dai."Port 2" {}
	Object.PCM.pcm_caps."playback" {
		name "Port2 Playback"
	}
	Object.PCM.pcm_caps."capture" {
		name "Port2 Capture"
	}
}

Object.PCM.pcm."3" {
	name	"DMIC"
	direction	"capture"
	Object.Base.fe_dai."DMIC01" {}
	Object.PCM.pcm_caps."capture" {
		name "DMIC01 Capture"
		channels_min		4
		channels_max		4
	}
}

#
# List of all DAI's
#
# SSP Index: 0, Direction: duplex
#
Object.Dai.SSP."0" {
	direction		"duplex"
	stream_name		"NoCodec-0"
	id 			0
	default_hw_conf_id	0
	format			"s24le"
	quirks			"lbm_mode"
	sample_bits		24
	Object.Base.hw_config."SSP0 hw_config 0" {
		id		0
		mclk_freq	24000000
		bclk_freq	4800000
		tdm_slot_width	25
	}

	#Add DAI widgets
	Object.Widget.dai."playback" {
		type		"dai_in"
		period_source_count	2
		period_sink_count	0
		index			1
	}

	Object.Widget.dai."capture" {
		type		"dai_out"
		period_source_count	0
		period_sink_count	2
		index			2
	}
}

Object.Dai.SSP."1" {
	direction		"duplex"
	stream_name		"NoCodec-1"
	id 			1
	default_hw_conf_id	1
	format			"s24le"
	quirks			"lbm_mode"
	sample_bits		24
	Object.Base.hw_config."SSP1 hw_config 0" {
		id		1
		mclk_freq	24000000
		bclk_freq	4800000
		tdm_slot_width	25
	}

	#Add DAI widgets
	Object.Widget.dai."playback" {
		type		"dai_in"
		period_source_count	2
		period_sink_count	0
		index			1
	}

	Object.Widget.dai."capture" {
		type		"dai_out"
		period_source_count	0
		period_sink_count	2
		index			2
	}
}

Object.Dai.SSP."2" {
	direction		"duplex"
	stream_name		"NoCodec-2"
	id 			2
	default_hw_conf_id	2
	format			"s24le"
	quirks			"lbm_mode"
	sample_bits		24
	Object.Base.hw_config."SSP2 hw_config 0" {
		id		2
		mclk_freq	24000000
		bclk_freq	4800000
		tdm_slot_width	25
	}

	#Add DAI widgets
	Object.Widget.dai."playback" {
		type		"dai_in"
		period_source_count	2
		period_sink_count	0
		index			1
	}

	Object.Widget.dai."capture" {
		type		"dai_out"
		period_source_count	0
		period_sink_count	2
		index			2
	}
}

Object.Dai.DMIC."0" {
	dai_index			0
	direction		"capture"
	stream_name		"dmic01"
	id 			6
	format			"s32le"
	default_hw_config_id	3
	Object.Base.hw_config."DMIC hw_config 0" {
		id	3
	}
	driver_version		1
	clk_min		500000
	clk_max		4800000
	duty_min		40
	duty_max		60
	sample_rate		48000
	fifo_word_length	32
	unmute_ramp_time_ms	200
	num_pdm_active		2

	# PDM controller config
	Object.Base.pdm_config."0" {
		ctrl_id	0
	}
	Object.Base.pdm_config."1" {
		ctrl_id	1
	}

	#include DAI components
	Object.Widget.dai."capture" {
		type		"dai_out"
		period_source_count	0
		period_sink_count	2
		index			2
	}
}

#
# List of all endpoint connections
#
Object.Base {
	# Connect: Pipeline 1 Buffer 1 -> SSP 0 Playback DAI
	route."0" {
		source	"buffer.1.1"
		sink	"dai.SSP.0.playback"
	}

	# Connect: SSP 0 Capture DAI -> Pipeline 2 Buffer 1
	route."1" {
		source	"dai.SSP.0.capture"
		sink	"buffer.2.1"
	}

	route."2" {
		source	"buffer.3.1"
		sink	"dai.SSP.1.playback"
	}

	route."3" {
		source	"dai.SSP.1.capture"
		sink	"buffer.4.1"
	}

	route."4" {
		source	"buffer.5.1"
		sink	"dai.SSP.2.playback"
	}

	# Connect: SSP 0 Capture DAI -> Pipeline 2 Buffer 1
	route."5" {
		source	"dai.SSP.2.capture"
		sink	"buffer.6.1"
	}

	route."6" {
		source	"dai.DMIC.0.capture"
		sink	"buffer.7.0"
	}
}

